deploy:
  runs-on: ubuntu-latest
  needs: [build_mypage, build_everyday]
  permissions:
    contents: write

  steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        clean: true

    - name: Download mypage artifact
      uses: actions/download-artifact@v4
      with:
        name: mypage-site
        path: mypage

    - name: Download everyday artifact
      uses: actions/download-artifact@v4
      with:
        name: everyday-site
        path: everyday

    - name: Prepare deployment folder
      run: |
        mkdir deploy_root
        # mypage/_site の中身を deploy_root/mypage にコピー
        mkdir -p deploy_root/mypage
        cp -r mypage/* deploy_root/mypage/
        # everyday/_site の中身を deploy_root/everyday にコピー
        mkdir -p deploy_root/everyday
        cp -r everyday/* deploy_root/everyday/

    - name: Deploy to gh-pages
      uses: peaceiris/actions-gh-pages@v4
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: deploy_root
        user_name: 'github-actions[bot]'
        user_email: 'github-actions[bot]@users.noreply.github.com'
